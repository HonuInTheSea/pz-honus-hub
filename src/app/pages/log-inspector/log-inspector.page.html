<ng-container *transloco="let t">
<div class="grid">
  <div class="col-12 log-inspector-container">
    <p-card header="{{ t('logInspector.title') }}">
      <div class="controls">
        <div class="control-section">
          <div class="field log-file-field">
            <label for="log-file-path">{{ t('logInspector.fields.logFile') }}</label>
            <div class="log-file-row">
              <input
                id="log-file-path"
                type="text"
                pInputText
                class="auto-width-input"
                [style.width]="filePathInputWidth"
                [(ngModel)]="filePath"
                (ngModelChange)="onFiltersChanged()"
                [placeholder]="filePathPlaceholder"
                autocomplete="off"
              />
              <button pButton type="button" label="{{ t('common.browse') }}" (click)="onBrowse()"></button>
            </div>
          </div>
        </div>

        <div class="control-section">
          <div class="control-grid">
            <div class="field">
              <label for="levels">{{ t('logInspector.fields.types') }}</label>
              <p-multiSelect
                id="levels"
                [options]="levelOptions"
                [(ngModel)]="selectedLevels"
                optionLabel="label"
                optionValue="value"
                [filter]="false"
                display="chip"
                placeholder="{{ t('logInspector.fields.typesPlaceholder') }}"
                (onChange)="onFiltersChanged()"
              ></p-multiSelect>
            </div>

            <div class="field">
              <label for="max-entries">{{ t('logInspector.fields.maxEntries') }}</label>
              <input
                id="max-entries"
                type="number"
                pInputText
                [(ngModel)]="maxEntries"
                (ngModelChange)="onFiltersChanged()"
                min="1"
                step="50"
              />
            </div>

            <div class="field">
              <label for="from-time">{{ t('logInspector.fields.from') }}</label>
              <input
                id="from-time"
                type="datetime-local"
                pInputText
                [(ngModel)]="fromLocal"
                (change)="onFiltersChanged()"
              />
            </div>

            <div class="field">
              <label for="to-time">{{ t('logInspector.fields.to') }}</label>
              <input
                id="to-time"
                type="datetime-local"
                pInputText
                [(ngModel)]="toLocal"
                (change)="onFiltersChanged()"
              />
            </div>

            <div class="field polling">
              <label for="polling-toggle">{{ t('logInspector.fields.livePolling') }}</label>
              <p-toggleswitch
                inputId="polling-toggle"
                [(ngModel)]="pollingEnabled"
                (ngModelChange)="onPollingChanged()"
              ></p-toggleswitch>
            </div>

            <div class="field polling-ms">
              <label for="polling-s">{{ t('logInspector.fields.pollingEverySeconds') }}</label>
              <input
                id="polling-s"
                type="number"
                pInputText
                [(ngModel)]="pollingSeconds"
                (ngModelChange)="onPollingChanged()"
                min="0.25"
                step="0.25"
              />
            </div>

            <div class="field search-field">
              <label for="search-text">{{ t('logInspector.fields.searchMessage') }}</label>
              <input
                id="search-text"
                type="text"
                pInputText
                class="auto-width-input"
                [style.width]="searchInputWidth"
                [(ngModel)]="searchText"
                (ngModelChange)="onFiltersChanged()"
                placeholder="{{ t('logInspector.fields.searchPlaceholder') }}"
                autocomplete="off"
              />
            </div>
          </div>
        </div>
      </div>

      @if (loadError) {
        <p-message severity="warn" [text]="loadError"></p-message>
      }

      <p-table
        class="log-table"
        [value]="filteredEntries"
        [paginator]="true"
        paginatorPosition="both"
        [rows]="tableRows"
        [first]="tableFirst"
        [rowsPerPageOptions]="[50,100,250,500,1000]"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="t('logInspector.table.pageReport')"
        sortMode="single"
        sortField="timestampMs"
        [sortOrder]="-1"
        dataKey="sourceLine"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="timestampMs" style="width: 210px">
              <div class="flex justify-between items-center">
                <span class="flex items-center gap-1">
                  <span>{{ t('logInspector.table.timestamp') }}</span>
                  <p-sortIcon field="timestampMs"></p-sortIcon>
                </span>
              </div>
            </th>
            <th pSortableColumn="level" style="width: 150px">
              <div class="flex justify-between items-center">
                <span class="flex items-center gap-1">
                  <span>{{ t('logInspector.table.type') }}</span>
                  <p-sortIcon field="level"></p-sortIcon>
                </span>
              </div>
            </th>
            <th pSortableColumn="message">
              <div class="flex justify-between items-center">
                <span class="flex items-center gap-1">
                  <span>{{ t('logInspector.table.message') }}</span>
                  <p-sortIcon field="message"></p-sortIcon>
                </span>
              </div>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-entry>
          <tr [ngClass]="rowClass(entry)">
            <td class="mono">
              {{ formatTimestamp(entry) }}
            </td>
            <td>
              <p-tag [value]="entry.level" [severity]="tagSeverity(entry.level)"></p-tag>
            </td>
            <td class="message-cell">
              <pre class="message-pre">{{ entry.message }}</pre>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

</ng-container>
